<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/buy.css">
    <link rel="stylesheet" href="../css/shops.css">
    <title>Join揪飲 - 我要點餐</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <script>
    	function getUserByName(name){
   		
    		var xhr = new XMLHttpRequest();
    		xhr.onreadystatechange= function(){
    			if(xhr.readyState === XMLHttpRequest.DONE){
    				if(xhr.status === 200){
    					var userData = JSON.parse(xhr.responseText);
    					updateUserInfo(userData);
    				}else{
    					console.log("讀取資料失敗:",xhr.statusText);
    				}
    			}
    		};
  		
    		xhr.open("GET", `/user/name/${name}`,true);
    		xhr.send();
    	}
    	function updateUserInfo(userData){   
    	    var companyElement = document.querySelector("[data-id='company']");
    	    var deptElement = document.querySelector("[data-id='dept']");
    	    var emailElement = document.querySelector("[data-id='email']");

            companyElement.innerText = `${userData.company}`;
            deptElement.innerText = `${userData.dept}`;
            emailElement.innerText = `${userData.email}`;
           
		}

    </script>
</head>
<body>
    <!-- NavBar -->
    <div style="margin-top: 0px;">
      <nav class="navbar navbar-expand-lg" style="height: 100px;">
          <div class="container-fluid">
            <div class="navbar-header" style="width: 200px;margin-top: -20px;">
              <a class="navbar-brand" href="./index.html"><img src="../images/join_LOGO.png" width="120%" height="120%"></a>
            </div>
            <ul class="nav navbar-nav d-flex justify-content-center" style="flex: 1; font-size: 32px;">
                <li class="nav-item nav-item-padding"><a class="nav-link" href="./shops.html">合作店家</a></li>
                <li class="nav-item nav-item-padding"><a class="nav-link" href="./groupbuying.html">我要揪團</a></li>
                <li class="nav-item nav-item-padding"><a class="nav-link" href="./buy.html">我要點餐</a></li>
              </ul>
              <ul class="nav navbar-nav" style="margin-right: 40px;">
                <span style="font-size: 24px;">
                    <a href="index.html" class="nav-link">登出</a>
                </span>
              </ul>
          </div>
        </nav>
  </div>
    <br>
    <h1 style="text-align: center;color: white;">我要點餐</h1>
    <!-- 點選資料後帶入 -->

  <div class="container-booking">
    <div class="row col-10 mx-auto">
      <div class="col-4">1️⃣&nbsp;&nbsp;揪團發起人：
        <select class="user-select" style="font-size: 26px;" onchange="getUserByName(this.value)">
          <option selected disabled>請選擇揪團發起人</option>
          <option value="user2">user2</option>
          <option value="user3">user3</option>
        </select>  
      </div>
      <div class="col-4 userInfo" id="userInfo">
        <p>公司：<span data-id="company"></span></p> <br>
        <p>部門：<span data-id="dept"></span></p> <br>
        <p>Email：<span data-id="email"></span></p>
      </div>
    </div>
    <div class="row col-10 mx-auto">
      <div class="col-4">2️⃣&nbsp;&nbsp;送餐日期
        <select class="date-select"id="deliveryDate">
          <option selected>請點選送餐日期</option>
          <option id="deliveryToday3" value='today3'>今天</option>
          <option id="deliveryTomorrow3" value='tomorrow3'>明天</option>
          <option id="deliverydayAfterTomorrow3" value="dayAfterTomorrow3">後天</option>
        </select>  
      </div>
      <div class="col-4">希望送達時間： &#20;
        <p id="deliveryTimeDisplay"></p>
      </div>
      <div class="col-2">
        揪團店家：&#20;
        <select id="shopSelect" onchange="updateShopInfo(this.value)"></select>
      </div>
    </div>
  </div>
      <!-- menu -->
  <div class="container-shop1" style="margin-top: 10px;">
      <div class="row">
          <div class="col-11">
            <img src="" width="100%" alt="菜單">
          </div>
    </div>
  </div>  

<!-- 購物車 -->
<div class="container-shop" style="margin-top: 10px;">
  <div class="row">
     <div class="col-9">
        <table class="tableSection">
          <thead class="tableTitle">
            <tr>
              <th>品名</th>
              <th>價格</th>
              <th>冰量</th>
              <th>糖量</th>
              <th>數量</th>
              <th> &nbsp; </th>
            </tr>
          	</thead>
        	<tbody id="productList">
        		<!-- 動態生成商品資訊 -->
			</tbody>
		</table>
      </div>
  </div>
</div>  
<!-- Check out Cart-->
<div class="checkout-container col-3">
  <div class="table">
    <div class="col1-priductName"></div>
    <div class="col2-price"></div>
    <div class="col3-ice"></div>
    <div class="col4-sugar"></div>
    <div class="col5-quantity"></div>
  </div>
  <div>
    <a class="cart" title="Your Cart" id="cart">
      <img src="../images/cart.png" style="width: 50px;height: 50;cursor: pointer;"/>
      <span class="empty" id="count-item" data-count="0">0 item</span>
    </a><div class="cleancart remove"><span>清除購物車</span><img id="cleancart" src="../images/delete.png" style="width: 45px;cursor: pointer;"></div>
  </div>
  <div class="total">
    <div class="total-text">Total：</div>
    <div class="total-amount">$ <span id="total-price">0</span></div>
  </div>
  <div class="checkout">
    <button onclick="checkout()" class="btn btn-primary" style="height: 50px;width: 140px;font-size: 26px;">送出訂單</button>
  </div>
</div>

<script>

	function updateShopInfo(shopId){
		getProductByShopId(shopId);
	}
	
	async function initProductList() {
		try{
			const response = await axios.get('/product');
			if(response.status === 200){
				const products = response.data;
			    const productSelect = document.getElementById('productList');
			    const productOptions = generateProductOptions(products);			    
			    productSelect.innerHTML = productOptions;				
			}else{
				console.error('獲取商品資料失敗:',response.statusText);
			}			
		}catch(error){
			console.error('獲取商品資料失敗:', error);
		}			
	}
	
	function generateProductOptions(products){
		
		console.log('生成選項:',products);
		return products.map(product => `
	        <tr>
		        <td>${product.productName}</td>
		        <td>${product.price}</td>
		        <td>
		            <select class="ice" name="ice">
		                <option value="正常冰">正常冰</option>
		                <option value="少冰">少冰</option>
		                <option value="去冰">去冰</option>
		            </select>
		        </td>
		        <td>
		            <select class="sugar" name="sugar">
		                <option value="正常糖">正常糖</option>
		                <option value="少糖">少糖</option>
		                <option value="無糖">無糖</option>
		            </select>
		        </td>
		        <td>
		            <input type="number" class="quantity" name="quantity" min="0" max="99" value="1">
		        </td>
		        <td>
		            <button class="add-to-cart" 
		                    data-product-id="${product.productId}" 
		                    data-product-name="${product.productName}" 
		                    data-price="${product.price}">
	                    添加到購物車
		            </button>
		        </td>
		    </tr>
		`).join('');
	}
	
	initProductList();
/*		document.addEventListener('click',function(event){
			if(event.target.classList.contains('add-to-cart')){
			      const productId = event.target.getAttribute('data-product-id');
			      const productName = event.target.getAttribute('data-product-name');
			      const price = event.target.getAttribute('data-price');
			      const ice = event.target.parentNode.parentNode.querySelector('.ice').value;
			      const sugar = event.target.parentNode.parentNode.querySelector('.sugar').value;
			      const quantity = event.target.parentNode.parentNode.querySelector('.quantity').value;
	
			      addToCart(productId,productName,price,ice,sugar,quantity);
			}
		}); */

</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
<script src="../js/buy.js"></script>
<script src="../js/users.js"></script>
    </body>

</html>
